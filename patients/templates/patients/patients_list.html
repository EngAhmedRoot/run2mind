{% extends 'run2mind/base.html'%}
{% load i18n %}
{% load static %}
{% get_current_language as LANGUAGE_CODE %}

{% block title %} {% trans "Patients" %} {% endblock %}

{% block content_area %}
<div class="experts-page ">
        <!-- start hero section -->
        <div class="experts-hero mb-2 ">
            <div class="container">
				<div class="row">
					<div class="col-lg-4">
					</div>
					<div class="col-lg-8">
						<h1 class="hero-title fw-600 cl-main" style="">
							{% trans "Meet our Patients" %} <span class="success fs-5 mx-2 mx-lg-3">RUN2MIND</span>
						</h1>
					</div>
				</div>
            </div>
        </div>
        <!-- end hero section -->


        <!-- Start Experts Main Sec -->
        <div class="experts-main">
            <div class="container">
                <div class="row">
                    <div class="col-lg-4">
						<div class="d-flex align-items-center mt-4 mb-4">
							<h4 class="fs-5 fw-bold cl-main">
									{% trans "PATIENTS Filter" %}
							</h4>
								
						</div>
						
                        <!-- Filter -->
                        <div class="experts-filter">
						
                            <!-- Filter Header -->
                            <div class="experts-filter_header p-3 d-flex align-items-center justify-content-between">
                                <div class="d-flex align-items-center ">
                                    <span class="icon">
                                        <svg width="30" height="30" viewBox="0 0 30 30" fill="none"
                                            xmlns="http://www.w3.org/2000/svg">
                                            <path fill-rule="evenodd" clip-rule="evenodd"
                                                d="M6.25029 10.9062V7.57625C6.22942 6.17456 7.3486 5.02124 8.75029 5H21.2503C22.652 5.02124 23.7712 6.17456 23.7503 7.57625V10.9062C23.7513 11.2461 23.6199 11.5729 23.384 11.8175L17.8665 16.25C17.6307 16.4946 17.4993 16.8214 17.5003 17.1612V23.6725C17.5029 24.1552 17.2364 24.5992 16.809 24.8237L14.309 26.1112C13.9162 26.3077 13.4492 26.2836 13.0787 26.0478C12.7081 25.812 12.4886 25.399 12.5003 24.96V17.1612C12.5013 16.8214 12.3699 16.4946 12.134 16.25L6.61654 11.8162C6.38098 11.5719 6.24965 11.2456 6.25029 10.9062Z"
                                                stroke="white" stroke-width="1.5" stroke-linecap="round"
                                                stroke-linejoin="round" />
                                        </svg>
                                    </span>

                                    <span class="fs-5 text-white d-flex d-lg-none mx-2">
                                        {% trans "Filter" %}
                                    </span>

                                </div>

                                <span class="fs-5 text-white d-none d-lg-flex">
                                    {% trans "Filter" %}
                                </span>

                                <span id="close-filter" class="fs-5 text-white d-flex d-lg-none cursor-pointer">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" fill="#fff" width="30px"
                                        height="30px">
                                        <path
                                            d="M 9.15625 6.3125 L 6.3125 9.15625 L 22.15625 25 L 6.21875 40.96875 L 9.03125 43.78125 L 25 27.84375 L 40.9375 43.78125 L 43.78125 40.9375 L 27.84375 25 L 43.6875 9.15625 L 40.84375 6.3125 L 25 22.15625 Z" />
                                    </svg>
                                </span>
                            </div>
							
                            <!-- Filter Body -->
                            <div class="filter-body p-3">
                                

                                

                                <!-- Therapist Gender -->
                                <div class="mb-3 mb-md-4">
                                    <div class="filter-label fs-5 cl-main">
                                        {% trans "Gender" %}
                                    </div>
                                    <div class="form-check form-check-inline d-inline-flex align-items-center">
                                        <input class="form-check-input gender-filter" type="checkbox" id="male" value="male">
										<label class="form-check-label pt-1 fs-6 cl-darkLight" for="male">
											{% trans "Male" %}
										</label>
                                    </div>
                                    <div class="form-check form-check-inline d-inline-flex align-items-center">
                                        <input class="form-check-input gender-filter" type="checkbox" id="female" value="female">
										<label class="form-check-label pt-1 fs-6 cl-darkLight" for="female">
											{% trans "Female" %}
										</label>
                                    </div>
                                </div>

                                <!-- Phone -->
                                <div class="mb-3 mb-md-4">
                                    <div class="filter-label fs-5 cl-main">
                                        {% trans "Phone" %}
                                    </div>
                                    <div class=" form-check-inline ">
                                       <input class="" type="text" id="phone-search" value="" oninput="this.value = this.value.replace(/[^0-9]/g, '')" maxlength="15">

                                    </div>
                                    
                                </div>

								<!-- Age -->
                                <div class="mb-3 mb-md-4">
                                    <div class="filter-label fs-5 cl-main mb-2">
                                        {% trans "Age" %}
                                    </div>
                                    <input type="text" id="priceSlider" />
                                </div>

                                <!-- Actions Buttons -->
                                <div class="actions pt-2 pt-md-3 mt-4 mt-md-5">
                                    <div class="row">
                                        <div class="col-sm-6 my-2">
                                            <button id="apply-filters" class="btn-main  w-100 px-0" style="background-color:#673191; color:white;">
                                                {% trans "Apply" %}
                                            </button>
                                        </div>
                                        <div class="col-sm-6 my-2">
                                            <button class="btn-main white w-100 px-0">
                                                {% trans "Clear" %}
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


                    <!--  -->
                    <div class="col-lg-8">
                        <!-- Search Input -->
                        <div class="input-container search-input mb-1">
                            <div class="input">
                                <input type="text" value="" name="search" id="name-search" class="px-3 w-100 bg-white">
                                <label for="search" class="input-label">{% trans "Search Patients" %}</label>
								<button onclick="$('#apply-filters').click();">
                                <div class="search-icon">
									
                                    <svg width="30" height="30" viewBox="0 0 42 42" fill="none"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" clip-rule="evenodd"
                                            d="M6.28184 31.5221C3.83145 29.0201 2.16946 25.8537 1.50201 22.4158C0.829045 18.9683 1.17461 15.3994 2.49651 12.145C3.80711 8.90886 6.04467 6.13212 8.92818 4.16348C14.7786 0.167756 22.4804 0.167756 28.3308 4.16348C31.2144 6.13212 33.4519 8.90886 34.7625 12.145C36.0844 15.3994 36.43 18.9683 35.757 22.4158C35.0896 25.8537 33.4276 29.0201 30.9772 31.5221C27.732 34.8523 23.2793 36.7305 18.6295 36.7305C13.9797 36.7305 9.527 34.8523 6.28184 31.5221V31.5221Z"
                                            stroke="#673191" stroke-width="2" stroke-linecap="round"
                                            stroke-linejoin="round" />
                                        <path
                                            d="M18.7677 8.52686C18.2185 8.58506 17.8204 9.07746 17.8786 9.62667C17.9368 10.1759 18.4292 10.5739 18.9784 10.5157L18.7677 8.52686ZM24.9307 14.0223C25.146 14.5309 25.7328 14.7686 26.2414 14.5533C26.75 14.338 26.9877 13.7512 26.7724 13.2426L24.9307 14.0223ZM31.9414 30.5424C31.5505 30.1522 30.9173 30.1528 30.5271 30.5436C30.137 30.9345 30.1375 31.5677 30.5284 31.9579L31.9414 30.5424ZM40.1277 41.5402C40.5186 41.9304 41.1518 41.9298 41.5419 41.5389C41.9321 41.1481 41.9316 40.5149 41.5407 40.1247L40.1277 41.5402ZM18.9784 10.5157C21.5181 10.2466 23.935 11.6704 24.9307 14.0223L26.7724 13.2426C25.4334 10.0798 22.1832 8.16495 18.7677 8.52686L18.9784 10.5157ZM30.5284 31.9579L40.1277 41.5402L41.5407 40.1247L31.9414 30.5424L30.5284 31.9579Z"
                                            fill="#673191" />
                                    </svg>
									
                                </div>
								</button>
                            </div>
                        </div>
						
						
						<div id="results-container">
							{% include "patients/_patients_list_partial.html" %}
						</div>




                    <!-- Filter btn ==> Mobile -->
                    <div id="filter-mob"
                        class="filter-mob cursor-pointer d-lg-none d-flex align-items-center m-auto px-4 py-2">
                        <span class="icon">
                            <svg width="30" height="30" viewBox="0 0 30 30" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" clip-rule="evenodd"
                                    d="M6.25029 10.9062V7.57625C6.22942 6.17456 7.3486 5.02124 8.75029 5H21.2503C22.652 5.02124 23.7712 6.17456 23.7503 7.57625V10.9062C23.7513 11.2461 23.6199 11.5729 23.384 11.8175L17.8665 16.25C17.6307 16.4946 17.4993 16.8214 17.5003 17.1612V23.6725C17.5029 24.1552 17.2364 24.5992 16.809 24.8237L14.309 26.1112C13.9162 26.3077 13.4492 26.2836 13.0787 26.0478C12.7081 25.812 12.4886 25.399 12.5003 24.96V17.1612C12.5013 16.8214 12.3699 16.4946 12.134 16.25L6.61654 11.8162C6.38098 11.5719 6.24965 11.2456 6.25029 10.9062Z"
                                    stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                        </span>

                        <span class="fs-5 text-white">
                            {% trans "Filter" %}
                        </span>
                    </div>
                </div>
            </div>
        </div>
        <!-- End of Patients Main Sec -->

    </div>
</div>
	

	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script src="{% static '/run2mind/js/rSlider.min.js' %}"></script>

  <script>	
$(document).ready(function () {
    const mySlider = new rSlider({
        target: '#priceSlider',
        values: [10, 15, 20, 25, 30, 35, 40, 45, 50, 55, 60, 65, 70, 75, 80, 85, 90, 95, 100],
        range: true,
        tooltip: true,
        scale: true,
        labels: true,
        set: [25, 45],  // القيم الافتراضية
        onChange: (value) => {
			if (typeof value === 'string' && value.includes(',')) {
				value = value.split(',').map(val => parseInt(val.trim(), 10)); // تحويل النص إلى أرقام
			}
						
			if (Array.isArray(value)) {
				value.forEach((val, index) => {
					console.log(`Value at index ${index}: ${val}`);
				});
			} else {
				console.log('Single Value:', value);
			}
		}
    });
	
	
	
	
    $('#apply-filters').on('click', function () {
        const namesearch=$("#name-search").val();
		const phonesearch=$("#phone-search").val();
		console.log(phonesearch);
		
		const genders = $('input[type="checkbox"].gender-filter:checked').map(function () {
            return $(this).val();
        }).get();



		let ageRange = mySlider.getValue();
	
		if (typeof ageRange === 'string' && ageRange.includes(',')) {
			ageRange = ageRange.split(',').map(val => parseInt(val.trim(), 10));  // تحويل النص إلى مصفوفة من الأرقام
		}
		
		const minAge = ageRange[0];
		const maxAge = ageRange[1];
    		
    
        if (namesearch.length === 0 && genders.length === 0 && phonesearch.length === 0) {
            console.log("No filters selected.");
            return;  
        }
		
		
        $.ajax({
            url: window.location.pathname,
            type: 'GET',
            data: { 
				'name':namesearch,
				'phone':phonesearch,
				'gender': genders,
				'min_age': minAge,
                'max_age': maxAge

				
			},  
            traditional: true,
            beforeSend: function () {
                $('#results-container').html('<p>Loading...</p>');
            },
            success: function (response) {
                $('#results-container').html(response.html);
            },
            error: function (xhr, status, error) {
                $('#results-container').html('<p>An error occurred while loading results.</p>');
            }
        });
    });
});

  </script>
{% endblock %}